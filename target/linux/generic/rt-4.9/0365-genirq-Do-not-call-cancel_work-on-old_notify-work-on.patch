From dc8504e44c2418773872de5e8cf3aafd6c00aa75 Mon Sep 17 00:00:00 2001
From: Steven Rostedt <rostedt@goodmis.org>
Date: Fri, 15 Nov 2019 09:28:29 -0500
Subject: [PATCH 365/366] genirq: Do not call cancel_work on old_notify->work
 on PREEMPT_RT

When PREEMPT_RT is configured, old_notify->work does not exist, and
instead swork is used. Unfortunately, there is no cancel_work() for
swork. This is a known bug, and 4.4 will just need to deal with it
as the real solution to this is to backport all the work queue code
from RT mainline.

Signed-off-by: Steven Rostedt <rostedt@goodmis.org>
---
 kernel/irq/manage.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

Index: linux-4.9.207/kernel/irq/manage.c
===================================================================
--- linux-4.9.207.orig/kernel/irq/manage.c
+++ linux-4.9.207/kernel/irq/manage.c
@@ -371,7 +371,9 @@ irq_set_affinity_notifier(unsigned int i
 	raw_spin_unlock_irqrestore(&desc->lock, flags);
 
 	if (old_notify) {
+#ifndef CONFIG_PREEMPT_RT_BASE
 		cancel_work_sync(&old_notify->work);
+#endif
 		kref_put(&old_notify->kref, old_notify->release);
 	}
 
